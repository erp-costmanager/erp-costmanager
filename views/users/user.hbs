<nav class="user-nav" >
  <a class="user-nav__link active-link" href="/user">Start</a>
  <a class="user-nav__link" href="/profile">Profile</a>
</nav>
<div class="user-container">
  {{#if errorMessage}}
  <div class="text-bg-danger p-3 my-2 w-100 text-center">{{errorMessage}}</div>
  {{/if}}
<p class="collapse-container">
  <a
    class="btn btn-primary collapse-container__btn"
    data-bs-toggle="collapse"
    href="#newPurchaseRequest"
    role="button"
    aria-expanded="false"
    aria-controls="newPurchaseRequest"
  >
    Request new purchase
  </a>

</p>
<div class="collapse collapse-container__inside" id="newPurchaseRequest">
  <div class="card card-body">
    <form
      class="new-purchase-form"
      action="/user/newPurchase"
      method="post"
    >
      <label for="item">Item</label>
      <input type="text" name="item" id="item" />
      <label for="cost">Cost</label>
      <input type="number" min="0" step="0.01" name="cost" id="cost" />
      <label for="reason">Reason for request:</label>
      <textarea name="reason" id="reason" cols="24" >
      </textarea>
      <button class="new-purchase-form__btn">Submit</button>
    </form>
  </div>
</div>

<section class="requested-purchases">
  <h4 class="requested-purchases__title">Purchase requests</h3>
  <h6 class="requested-purchases__filter-title">Filter by type of request:</h6>
   <form action="/user/filterPurchaseRequests" method="post" class="requested-purchases__filter-form">
    <label for="all-requests">All
    <input type="radio" name="filterOption" value="all" id="all-requests" checked{{#if (isAllFilterChecked filterOption)}} checked {{/if}}>
    </label>
    <label for="pending-requests">Pending
    <input type="radio" name="filterOption" value="pending" id="pending-requests" {{#if (isPendingFilterChecked filterOption)}} checked {{/if}}>
    </label>
    <label for="approved-requests">Approved
    <input type="radio" name="filterOption" value="approved" id="approved-requests" {{#if (isApprovedFilterChecked filterOption)}} checked {{/if}}>
    </label>
    <label for="disapproved-requests">Disapproved
    <input type="radio" name="filterOption" value="disapproved" id="disapproved-requests" {{#if (isDisapprovedFilterChecked filterOption)}} checked {{/if}}>
    </label>
    <label for="my-requests">My requests
    <input type="radio" name="filterOption" value="myRequests" id="my-requests" {{#if (isMyRequestsFilterChecked filterOption)}} checked {{/if}}>
    </label>
    <button class="btn btn-primary">Filter</button>
  </form>
  <div class="request-purchases__list">
    {{#each purchaseRequests}}
  <p class="collapse-container">
  <a
    class="btn 
    {{#if (isPending this)}}
    btn-warning 
    {{else if (isApproved this)}}
    btn-success
    {{else}}
    btn-danger
    {{/if}}
    collapse-container__btn"
    data-bs-toggle="collapse"
    href="#id{{_id}}"
    role="button"
    aria-expanded="false"
    aria-controls="id{{_id}}"
    style="width: 90%"
  >
    Item: {{item}} | Cost: {{cost}} | Status: {{status}}
  </a>

</p>
<div class="collapse collapse-container__inside" id="id{{_id}}">
  <div class="card card-body">
   <form
      class="purchase-request-form"
      action="/user/processPurchaseRequest"
      method="post"
    >
      <output name="item"><strong>Item:</strong> {{item}}</output>
      <output name="cost"><strong>Cost:</strong> {{cost}}</output>
      <output name="reason"><strong>Reason for request:</strong> {{reason}}</output>
      <output name="name"><strong>Requested by:</strong> {{createdBy.firstName}} {{createdBy.lastName}}</output>
      {{#if (isPendingAndIsUserManager this)}}
      <div>
      <input type="submit" name="action" value="Approve" class="purchase-request-form__btn btn btn-success">
      <input type="submit" name="action" value="Disapprove" class="purchase-request-form__btn btn btn-danger">
      </div>

      {{else if (isPendingAndIsUsersOwnRequest this ../currentUser)}}
      <div>
       <input type="submit" name="action" value="Delete" class="btn btn-danger purchase-request-form__btn">
       <a href="/user/edit/{{_id}}" class="btn btn-info purchase-request-form__btn">Edit</a>
      </div>
      {{else}}
      <label><strong>Status:</strong>
      {{status}}
      {{/if}}
      <input name="id" type="hidden" value="{{_id}}">
      </label>
    </form>
  
  </div>
</div>
{{/each}}
  </div>
</section>
</div>
